<!-- app/views/imports/new.html.erb -->
<h1>データインポート</h1>

<!-- フラッシュ -->
<% if flash[:notice].present? %><p style="color:green"><%= flash[:notice] %></p><% end %>
<% if flash[:alert].present?  %><p style="color:#b00"><%= flash[:alert]  %></p><% end %>

<!-- バリデーションエラー -->
<% if defined?(@form) && @form&.errors&.any? %>
  <ul style="color:#b00; margin-left:1em;">
    <% @form.errors.full_messages.each do |m| %><li><%= m %></li><% end %>
  </ul>
<% end %>

<!-- 取込フォーム -->
<%= form_with url: imports_path, multipart: true, local: true do %>
  <p>
    対象：
    <%= select_tag :kind,
      options_for_select([["給与（payroll）","payroll"],["車両（vehicles）","vehicles"]],
                         (@form&.kind.presence || params[:kind] || "payroll")) %>
  </p>
  <p>
    ファイル：<input type="file" name="file" accept=".xlsx,.xls,.csv" required>
  </p>
  <p>
    <label>
      <input type="checkbox" name="save" value="1" <%= "checked" if params[:save] == "1" %>>
      （payrollのみ）プレビュー後に保存まで行う
    </label>
  </p>
  <p><button type="submit">取り込む</button></p>
<% end %>

<hr>

<!-- 結果表示（共通パーシャル） -->
<%= render "imports/result_summary",
           result: @result,
           kind:   (params[:kind] || @result&.dig(:meta, :kind) || "payroll") %>

<hr>
<ul>
  <li><%= link_to "ダッシュボードへ戻る", root_path %></li>
  <li><%= link_to "車両一覧へ", vehicles_path %></li>
</ul>
